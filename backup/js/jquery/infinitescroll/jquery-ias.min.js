/*!
 * Infinite Ajax Scroll, a jQuery plugin
 * Version 1.0.2
 * https://github.com/webcreate/infinite-ajax-scroll
 *
 * Copyright (c) 2011-2013 Jeroen Fiege
 * Licensed under MIT:
 * https://raw.github.com/webcreate/infinite-ajax-scroll/master/MIT-LICENSE.txt
 */
(function(a){Date.now=Date.now||function(){return +new Date()};a.ias=function(e){var n=a.extend({},a.ias.defaults,e);var c=new a.ias.util();var j=new a.ias.paging(n.scrollContainer);var i=(n.history?new a.ias.history():false);var g=this;var p=false;function d(){if(window.location.href.indexOf("mode=grid")!=-1){return n.item[0]}else{if(window.location.href.indexOf("mode=list")!=-1){return n.item[1]}else{return n.item[2]}}}function s(){var y;j.onChangePage(function(B,z,A){if(i){i.setPage(B,A)}n.onPageChange.call(this,B,A,z)});v();if(i&&i.havePage()){r();y=i.getPage();c.forceScrollTop(function(){var z;if(y>1){m(y);z=u(true);a("html, body").scrollTop(z)}else{v()}})}return g}s();function v(){o();n.scrollContainer.off("scroll.infinity").on("scroll.infinity",h)}function h(){var z,y;z=c.getCurrentScrollOffset(n.scrollContainer);y=u();if(z>=y){if(t()>=n.triggerPageThreshold){r();k(function(){w(z)})}else{w(z)}}}function r(){n.scrollContainer.off("scroll.infinity",h)}function o(){a(n.pagination).hide()}function u(z){var A,y;A=a(n.container).find(d()).last();if(A.size()===0){return 0}y=A.offset().top+A.height();if(!z){y+=n.thresholdMargin}return y}function w(A,z){var y;y=a(n.next).attr("href");if(!y){return r()}if(n.beforePageChange&&a.isFunction(n.beforePageChange)){if(n.beforePageChange(A,y)===false){return}}j.pushPages(A,y);r();q();f(y,function(F,D){var B=n.onLoadItems.call(this,D),C;if(B!==false){a(D).find("li.item").hide();var E=a(D).find("li.item").length;var G="";if(d().indexOf("products-list")!=-1){G="list"}else{G="grid"}if(G=="grid"){a(n.container).css("min-height",a(n.container).height());isotopDestroy()}C=a(n.container).find(d()).last();C.find("li.item").removeClass("last");C.append(a(D).find("li.item"));if(G=="grid"){isotopLoader(E,function(){C.find("li.item:hidden").fadeIn("fast");setTimeout(function(){a(n.container).css("min-height",0)},1000)})}if(G=="list"){geListColumn(function(){C.find("li.item:hidden").fadeIn("fast")})}}y=a(n.next,F).attr("href");a(n.pagination).replaceWith(a(n.pagination,F));l();o();if(y){v()}else{r()}n.onRenderComplete.call(this,D);b();if(z){z.call(this)}})}function f(C,D,B){var A=[],y,F=Date.now(),E,z;B=B||n.loaderDelay;a.get(C,null,function(G){y=a(n.container,G).eq(0);if(0===y.length){y=a(G).filter(n.container).eq(0)}if(y){y.find(d()).each(function(){A.push(this)})}if(D){z=this;E=Date.now()-F;if(E<B){setTimeout(function(){D.call(z,G,A)},B-E)}else{D.call(z,G,A)}}},"html")}function m(y){var z=u(true);if(z>0){w(z,function(){r();if((j.getCurPageNum(z)+1)<y){m(y);a("html,body").animate({scrollTop:z},400,"swing")}else{a("html,body").animate({scrollTop:z},1000,"swing");v()}})}}function t(){var y=c.getCurrentScrollOffset(n.scrollContainer);return j.getCurPageNum(y)}function q(){if(p==false){a(n.container).addClass("loading")}}function l(){a(n.container).removeClass("loading")}function x(z){var y=a(".ias_trigger");if(y.size()===0){y=a('<div class="ias_trigger"><a href="javascript:void(0);"><span>'+n.trigger+"</span></a></div>");y.hide()}a(y).unbind("click").bind("click",function(){y.addClass("active");z.call();return false});return y}function k(A){if(jQuery(n.next).length){var y=x(A),z;if(n.customTriggerProc!==false){n.customTriggerProc(y)}else{z=a(n.container).find(d()).last();z.nextAll(".toolbar-bottom").after(y);y.fadeIn();p=true}}}function b(){var y=x();y.remove();p=false}};a.ias.defaults={container:"#container",scrollContainer:a(window),item:".item",pagination:"#pagination",next:".next",noneleft:false,loaderDelay:600,triggerPageThreshold:3,trigger:"Load more items",thresholdMargin:0,history:true,onPageChange:function(){},beforePageChange:function(){},onLoadItems:function(){},onRenderComplete:function(){},customTriggerProc:false};a.ias.util=function(){var c=false;var e=false;var b=this;function d(){a(window).load(function(){c=true})}d();this.forceScrollTop=function(f){a("html,body").scrollTop(0);if(!e){if(!c){setTimeout(function(){b.forceScrollTop(f)},1)}else{f.call();e=true}}};this.getCurrentScrollOffset=function(g){var f,h;if(g.get(0)===window){f=g.scrollTop()}else{f=g.offset().top}h=g.height();return f+h}};a.ias.paging=function(){var e=[[0,document.location.toString()]];var h=function(){};var d=1;var b=new a.ias.util();function i(){a(window).on("scroll.infinity",g)}i();function g(){var l,n,m,k,j;l=b.getCurrentScrollOffset(a(window));n=c(l);m=f(l);if(d!==n){k=m[0];j=m[1];h.call({},n,k,j)}d=n}function c(j){for(var k=(e.length-1);k>0;k--){if(j>e[k][0]){return k+1}}return 1}this.getCurPageNum=function(j){j=j||b.getCurrentScrollOffset(a(window));return c(j)};function f(j){for(var k=(e.length-1);k>=0;k--){if(j>e[k][0]){return e[k]}}return null}this.onChangePage=function(j){h=j};this.pushPages=function(j,k){e.push([j,k])}};a.ias.history=function(){var c=false;var b=false;function d(){b=!!(window.history&&history.pushState&&history.replaceState);b=false}d();this.setPage=function(f,e){this.updateState({page:f},"",e)};this.havePage=function(){return(this.getState()!==false)};this.getPage=function(){var e;if(this.havePage()){e=this.getState();return e.page}return 1};this.getState=function(){var g,e,f;if(b){e=history.state;if(e&&e.ias){return e.ias}}else{g=(window.location.hash.substring(0,7)==="#/page/");if(g){f=parseInt(window.location.hash.replace("#/page/",""),10);return{page:f}}}return false};this.updateState=function(f,g,e){if(c){this.replaceState(f,g,e)}else{this.pushState(f,g,e)}};this.pushState=function(f,h,e){var g;if(b){history.pushState({ias:f},h,e)}else{g=(f.page>0?"#/page/"+f.page:"");window.location.hash=g}c=true};this.replaceState=function(f,g,e){if(b){history.replaceState({ias:f},g,e)}else{this.pushState(f,g,e)}}}})(jQuery);